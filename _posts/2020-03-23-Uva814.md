---
title: Uva 00814  The Letter Carrier’s Rounds
---

814 The Letter Carrier’s Rounds

For an electronic mail application you are to describe the SMTP-based communication that takes place
between pairs of MTAs. The sender’s User Agent gives a formatted message to the sending Message
Transfer Agent (MTA). The sending MTA communicates with the receiving MTA using the Simple
Mail Transfer Protocol (SMTP). The receiving MTA delivers mail to the receiver’s User Agent. After
a communication link is initialized, the sending MTA transmits command lines, one at a time, to the
receiving MTA, which returns a three-digit coded response after each command is processed. The sender
commands are shown below in the order sent for each message. There is more than one RCPT TO
line when the same message is sent to several users at the same MTA. A message to users at different
MTAs requires separate SMTP sessions.

HELO myname Identifies the sender to the receiver (yes, there is only one L)
MAIL FROM:< sender > Identifies the message sender
RCPT TO:< user > Identifies one recipient of the message
DATA Followed by an arbitrary number of lines of text comprising the message

body, ending with a line containing a period in column one.
QUIT Terminates the communication.

The following response codes are sent by the receiving MTA:

221 Closing connection (after QUIT)

250 Action was okay (after MAIL FROM and RCPT TO specifying an acceptable user, or completion
of a message)

354 Start sending mail (after DATA)

550 Action not taken; no such user here (after RCPT TO with unknown user)

## Input

The input contains descriptions of MTAs followed by an arbitrary number of messages. Each MTA
description begins with the MTA designation and its name (1 to 15 alphanumeric characters). Following
the MTA name is the number of users that receive mail at that MTA and a list of the users (1 to 15
alphanumeric characters each). The MTA description is terminated by an asterisk in column 1. Each
message begins with the sending user’s name and is followed by a list of recipient identifiers. Each
identifier has the form user@mtaname. The message (each line containing no more than 72 characters)
begins and terminates with an asterisk in column 1. A line with an asterisk in column 1 instead of a
sender and recipient list indicates the end of the entire input.

## Output

For each message, show the communication between the sending and receiving MTAs. Every MTA
mentioned in a message is a valid MTA; however, message recipients may not exist at the destination
MTA. The receiving MTA rejects mail for those users by responding to the RCPT TO command with
the 550 code. A rejection will not affect delivery to authorized users at the same MTA. If there is not
at least one authorized recipient at a particular MTA, the DATA is not sent. Only one SMTP session
is used to send a message to users at a particular MTA. For example, a message to 5 users at the same



Universidad de Valladolid OJ: 814 – The Letter Carrier’s Rounds 2/3

MTA will have only one SMTP session. Also a message is addressed to the same user only once. The
order in which receiving MTAs are contacted by the sender is the same as in the input file. As shown
in the sample output, prefix the communication with the communicating MTA names, and indent each
non-empty communication line. No innecessary spaces should be printed.

## Sample Input
<p></p><p>MTA London 4 Fiona Paul Heather Nevil</p><p></p><p>MTA SanFrancisco 3 Mario Luigi Shariff</p><p></p><p>MTA Paris 3 Jacque Suzanne Maurice</p><p></p><p>MTA HongKong 3 Chen Jeng Hee</p><p></p><p>MTA MexicoCity 4 Conrado Estella Eva Raul</p><p></p><p>MTA Cairo 3 Hamdy Tarik Misa</p><p></p><p>*</p><p></p><p>Hamdy@Cairo Conrado@MexicoCity Shariff@SanFrancisco Lisa@MexicoCity</p><p></p><p>*</p><p></p><p>Congratulations on your efforts !!</p><p></p><p>--Hamdy</p><p></p><p>*</p><p></p><p>Fiona@London Chen@HongKong Natasha@Paris</p><p></p><p>*</p><p></p><p>Thanks for the report! --Fiona</p><p></p><p>*</p><p></p><p>*</p><p></p>

## Sample Output
<p></p><p>Connection between Cairo and MexicoCity</p><p></p><p>HELO Cairo</p><p></p><p>250</p><p></p><p>MAIL FROM:<Hamdy@Cairo></p><p></p><p>250</p><p></p><p>RCPT TO:<Conrado@MexicoCity></p><p></p><p>250</p><p></p><p>RCPT TO:<Lisa@MexicoCity></p><p></p><p>550</p><p></p><p>DATA</p><p></p><p>354</p><p></p><p>Congratulations on your efforts !!</p><p></p><p>--Hamdy</p><p></p><p>.</p><p></p><p>250</p><p></p><p>QUIT</p><p></p><p>221</p><p></p><p>Connection between Cairo and SanFrancisco</p><p></p><p>HELO Cairo</p><p></p><p>250</p><p></p><p>MAIL FROM:<Hamdy@Cairo></p><p></p><p>250</p><p></p><p>RCPT TO:<Shariff@SanFrancisco></p><p></p><p>250</p><p></p><p></p><p></p><p>Universidad de Valladolid OJ: 814 – The Letter Carrier’s Rounds 3/3</p><p></p><p>DATA</p><p></p><p>354</p><p></p><p>Congratulations on your efforts !!</p><p></p><p>--Hamdy</p><p></p><p>.</p><p></p><p>250</p><p></p><p>QUIT</p><p></p><p>221</p><p></p><p>Connection between London and HongKong</p><p></p><p>HELO London</p><p></p><p>250</p><p></p><p>MAIL FROM:<Fiona@London></p><p></p><p>250</p><p></p><p>RCPT TO:<Chen@HongKong></p><p></p><p>250</p><p></p><p>DATA</p><p></p><p>354</p><p></p><p>Thanks for the report! --Fiona</p><p></p><p>.</p><p></p><p>250</p><p></p><p>QUIT</p><p></p><p>221</p><p></p><p>Connection between London and Paris</p><p></p><p>HELO London</p><p></p><p>250</p><p></p><p>MAIL FROM:<Fiona@London></p><p></p><p>250</p><p></p><p>RCPT TO:<Natasha@Paris></p><p></p><p>550</p><p></p><p>QUIT</p><p></p><p>221</p>