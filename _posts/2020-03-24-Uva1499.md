---
title: Uva 01499  Gem And Prince
---


## Input

```text

Nowadays princess Claire wants one more guard and posts the ads throughout the kingdom. For her
unparalleled beauty, generality, goodness and other virtues, many people gather at the capital and
apply for the position. Because princess Claire is very clever, she doesnt want a fool to be her guard.
As Claire is clever, she invents a game to test the applicants. The game is described as follows.

The game begins with a rectangular board of n rows and m columns, containing nm grids. Each
grid is filled with a gem and each gem is covered by one color, denoted by a number.(as the following
shows).



Universidad de Valladolid OJ: 1499  Gem And Prince 2/3

If a gem has the same color with another one, and shares the same corner or the same border with
it, the two are considered to be adjacent. Two adjacent gems are said to be connective. And we define
that if A and B are connective, B and C are connective, then A and C are connective, namely the
adjacency is transitive. Each time we can choose a gem and pick up all of the gems connected to it,
including itself, and get a score equal to the square of the number of the gems we pick this time(but to
make the game more challenging, the number of gems to be picked each time must be equal or larger
than three).Another rule is that if one gem is picked, all the gems above it(if there is any)fall down to
fill its grid,and if there is one column containing no gems at all, all the columns at its right(also if there
is any) move left to fill the column. These rules can be shown as follows.

1 1 3 0 0 3 0 0 0 0 0 0

1 2 1 -> 0 2 0 -> 0 0 3 -> 0 3 0

1 1 2 0 0 2 0 2 2 2 2 0

[a] [b] [c] [d]



Universidad de Valladolid OJ: 1499  Gem And Prince 3/3

As the picture [a] above,all the gems that has color 1 are connective. After we choose one of them
to be picked, all the gems that are connected to it must also be picked together, as the picture [b] shows
(here we use 0 to denote the holes generated by the absence of gems).

Then the rest gems fall, as shown in picture [c]. Then the rest gems move left, as shown in picture
[d]. Because we picked six gems at this time, our score increases 6  6 = 36. And furthermore, because
we cannot find another gem, which has at least three gems connected to it(including itself),to be picked,
the game comes to an end.

Each applicant will face such a board and the one who gets the highest score will have the honor to
serve princess Claire.

Aswmtjdsj also wants to serve for princess Claire. But he realizes that competing with so many
people, even among whom there are powerful ACMers, apparently there is little chance to succeed.
With the strong desire to be the lucky dog, Aswmtjdsj asks you for help.

Can you help make his dream come true?
```

## Output

```text
There are no more than 15 test cases, separated by a blank line, end with EOF. Each case has n + 1
lines, the first line of a case has three integers n,m, k (1  n,m  8, 1  k  6). Each of the next n
lines contains m integers. The integer at (i+ 1)th line and jth column denotes the color of the gem at
the grid (i, j), where the grid(1, 1) denotes the top left one, while the grid(n,m) is the lower right one.
The integer in the grid is among [1, k].

```

## Sample Input

```text
For each case you should output the highest score you can get in one single line.

```

## Sample Output

```text
3 3 3

1 1 3

1 2 1

1 1 2

5 4 3

2 2 3 3

1 1 3 3

3 2 2 2

3 1 1 1

3 1 2 2

```
